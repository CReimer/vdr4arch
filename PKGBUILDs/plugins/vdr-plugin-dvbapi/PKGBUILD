# Maintainer: Christopher Reimer <c[dot]reimer[at]googlemail[dot]com>
pkgname=vdr-plugin-dvbapi
pkgver=1.0.2
_vdrapi=1.7.30
pkgrel=4
pkgdesc="A bridge between VDR and OScam."
url="https://github.com/manio/vdr-plugin-dvbapi"
arch=('x86_64' 'i686')
license=('GPL2')
depends=('gcc-libs' "vdr-api=${_vdrapi}")
optdepends=()
makedepends=()
conflicts=()
replaces=()
backup=()
install=''
source=("$pkgname-$pkgver.tar.bz2::https://github.com/manio/$pkgname/tarball/v$pkgver"
        'match_oscam_dvbapi_changes.diff')
md5sums=('59b395c23f74b3bb1e253fd1eae5166e'
         'ccfe482ad5a3647e6beac9f3e5abc54a')

package() {
  cd "${srcdir}/manio-${pkgname}-"*

  patch -i ${srcdir}/match_oscam_dvbapi_changes.diff

  if [ "${CARCH}" = "x86_64" ]; then
    CPUOPT='x86-64'
  else
    CPUOPT="${CARCH}"
  fi

  mkdir -p $pkgdir/usr/lib/vdr/plugins
  make CFLAGS="$(pkg-config vdr --variable=plugincflags)" \
       CXXFLAGS="$(pkg-config vdr --variable=plugincflags)" \
       VDRDIR="$(pkg-config vdr --variable=includedir)/vdr" \
       LIBDIR="$pkgdir/$(pkg-config vdr --variable=plugindir)" \
       LOCALEDIR="$pkgdir/$(pkg-config vdr --variable=localedir)" \
       CPUOPT="$CPUOPT" \
       PARALLEL=PARALLEL_128_SSE2 \
       CSAFLAGS="$(pkg-config vdr --variable=plugincflags) -funroll-loops"
  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}
