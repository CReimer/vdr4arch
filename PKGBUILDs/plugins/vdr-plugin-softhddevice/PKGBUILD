# Maintainer: Christopher Reimer <c[dot]reimer[at]googlemail[dot]com>
pkgname=vdr-plugin-softhddevice
pkgver=20120608
_gitver=da9886e
_vdrapi=1.7.28
pkgrel=1
pkgdesc=""
url="http://projects.vdr-developer.org/projects/plg-softhddevice"
arch=('x86_64' 'i686')
license=('AGPL3')
depends=('ffmpeg' 'libvdpau' "vdr-api=${_vdrapi}"  'xcb-util-wm')
optdepends=('nvidia: Required for VDPAU acceleration')
makedepends=('mesa' 'libxdamage' 'libxxf86vm' 'xcb-util' 'xcb-util-keysyms')
conflicts=()
replaces=()
backup=()
install=''
source=("http://projects.vdr-developer.org/git/$pkgname.git/snapshot/$pkgname-$_gitver.tar.bz2"
        'softhddevice-Make.global.diff')
md5sums=('efd0e6db409b4835dc4e956081baf190'
         'e16e42028e972c74e90f8ae0147959ac')

build() {
  cd "${srcdir}/${pkgname}-${_gitver}"

  patch -i ${srcdir}/softhddevice-Make.global.diff

  sed -i '/DAV_INFO/d' Makefile
  sed -i '/DUSE_OSS/d' Makefile
}

package() {
  cd "${srcdir}/${pkgname}-${_gitver}"
  mkdir -p $pkgdir/usr/lib/vdr/plugins
  make CFLAGS="$CFLAGS -fPIC" \
       CXXFLAGS="$CXXFLAGS -fPIC" \
       VDRDIR=/usr/include/vdr \
       LIBDIR=$pkgdir/usr/lib/vdr/plugins \
       LOCALEDIR=$pkgdir/usr/share/locale
  install -Dm644 AGPL-3.0.txt "$pkgdir/usr/share/licenses/$pkgname/COPYING"
  pkgver=${pkgver}_${_vdrapi}
}
