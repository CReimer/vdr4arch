# Maintainer: Christopher Reimer <c[dot]reimer[at]googlemail[dot]com>
pkgname=v4l-dvb-saa716x
pkgver=20120304
_hgver=f9ecf4091afc
_extramodules=extramodules-3.6-ARCH
url='https://bitbucket.org/powARman/v4l-dvb-saa716x/overview'
pkgrel=2
pkgdesc="Driver for Technotrend's S2-6400"
arch=('x86_64' 'i686')
license=('GPL2')
depends=('linux>=3.6' 'linux<3.7')
optdepends=()
makedepends=('linux-headers>=3.6' 'linux-headers<3.7')
install="${pkgname}.install"
source=("https://bitbucket.org/powARman/$pkgname/get/$_hgver.tar.bz2"
        "compat.diff")
md5sums=('a7b48b4ecfd5cf4e2ca7e2574043015b'
         '7e683b6855bbe1984d6aaf725366903b')

build() {
  _kernver="$(cat /lib/modules/${_extramodules}/version)"
  cd "${srcdir}/powARman-${pkgname}-${_hgver}"/linux/drivers/media/common/saa716x

  patch -i ${srcdir}/compat.diff

  make -C /lib/modules/${_kernver}/build CONFIG_SAA716X_CORE=m CONFIG_DVB_SAA716X_FF=m M=$(pwd) modules
}

package() {
  cd "${srcdir}/powARman-${pkgname}-${_hgver}"
  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
  cd linux/drivers/media/common/saa716x

  gzip *.ko
  install -Dm644 saa716x_core.ko.gz "$pkgdir/lib/modules/${_extramodules}/saa716x_core.ko.gz"
  install -Dm644 saa716x_ff.ko.gz "$pkgdir/lib/modules/${_extramodules}/saa716x_ff.ko.gz"
}
